!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/core"),require("@iotize/cordova-plugin-iotize-ble"),require("rxjs/operators"),require("@iotize/device-client.js/device"),require("@ionic-native/nfc/ngx"),require("@iotize/device-com-nfc.cordova"),require("@ionic/angular"),require("@ionic-native/nfc/ngx/index"),require("@angular/common")):"function"==typeof define&&define.amd?define("iotize-ng-com",["exports","rxjs","@angular/core","@iotize/cordova-plugin-iotize-ble","rxjs/operators","@iotize/device-client.js/device","@ionic-native/nfc/ngx","@iotize/device-com-nfc.cordova","@ionic/angular","@ionic-native/nfc/ngx/index","@angular/common"],t):t((e=e||self)["iotize-ng-com"]={},e.rxjs,e.ng.core,e.cordovaPluginIotizeBle,e.rxjs.operators,e.device,e.ngx,e.deviceComNfc_cordova,e.angular,e.index,e.ng.common)}(this,function(e,t,n,o,r,i,c,s,a,u,l){"use strict";function f(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,n,o){return new(n||(n=Promise))(function(r,i){function c(e){try{a(o.next(e))}catch(t){i(t)}}function s(e){try{a(o["throw"](e))}catch(t){i(t)}}function a(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(c,s)}a((o=o.apply(e,t||[])).next())})}function h(e,t){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function v(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)c.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i["return"])&&n.call(i)}finally{if(r)throw r.error}}return c}var y=function(){function e(){this.scanner=new o.BLEScanner,this._devicesArray=[],this.initObservables()}return Object.defineProperty(e.prototype,"isScanning",{get:function(){return this.scanner.isScanning},enumerable:!0,configurable:!0}),e.prototype.initObservables=function(){var e=this;this.devicesArray$=new t.BehaviorSubject([]);var n={next:function(t){e._devicesArray.push(t),e.devicesArray$.next(e._devicesArray)}};this.scannerSubscription=this.devices().pipe(r.distinct(function(e){return e.address})).subscribe(n)},e.prototype.startScan=function(){return this.scanner.start({}),this.devices().pipe(r.distinct(function(e){return e.address}))},e.prototype.checkAvailable=function(){return new Promise(function(e,t){iotizeBLE.checkAvailable(function(n){console.log(n),n?e():t("BlueTooth is not on and ready to use")},function(e){console.error(e),t(e)})})},e.prototype.devices=function(){return this.scanner.devicesObservable()},e.prototype.devicesArray=function(){return this.devicesArray$.asObservable()},e.prototype.clearDevices=function(e){void 0===e&&(e=[]),this._devicesArray=e,this.scannerSubscription.unsubscribe(),this.initObservables()},e.prototype.stopScan=function(){console.log("Stop Scanning ..."),this.scanner.stop()},e.prototype.getProtocol=function(e,t){var n="string"!=typeof e?e.address:e;return new o.BLEComProtocol(n,t)},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e=f([n.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(),b=function(){function e(){this.isReady=!1,this.connectionPromise=null,this.session=null,this.sessionSubscription=null}return e.prototype.init=function(e){return d(this,void 0,void 0,function(){var t,n=this;return h(this,function(o){switch(o.label){case 0:this.isReady=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),this.tap=i.Tap.create(),this.sessionSubscription=this.sessionState().subscribe(function(e){console.log("session changed"),n.session=e}),console.log("tap created"),this.connectionPromise=this.connect(e),console.log("waiting for connection promise"),[4,this.connectionPromise];case 2:return o.sent(),console.log("Connected"),this.isReady=!0,[3,4];case 3:throw t=o.sent(),console.error("init failed"),console.error(t),this.isReady=!1,t;case 4:return[2]}})})},e.prototype.connect=function(e){return this.tap.connect(e)},e.prototype.disconnect=function(){return d(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.isReady=!1,[4,this.tap.disconnect()];case 1:return t.sent(),this.clear(),[3,3];case 2:throw e=t.sent(),console.log(e),e;case 3:return[2]}})})},e.prototype.getSerialNumber=function(){return d(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,this.tap.service.device.getSerialNumber()];case 1:return[2,e.sent().body()]}})})},e.prototype.clear=function(){this.isReady=!1,this.sessionSubscription&&this.sessionSubscription.unsubscribe(),this.tap=null},e.prototype.login=function(e,t){return d(this,void 0,void 0,function(){return h(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),console.log("trying to log as ",e),[4,this.tap.login(e,t)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}})})},e.prototype.logout=function(){return d(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.tap.logout()];case 1:return e.sent(),[3,3];case 2:return e.sent(),[2,!1];case 3:try{return[2,!0]}catch(t){return[2,!1]}return[2]}})})},e.prototype.sessionState=function(){return this.tap.sessionState},e.prototype.sessionStateForceUpdate=function(){this.tap.refreshSessionState()},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e=f([n.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(),g=function(){function e(e,t){this.nfc=e,this.platform=t}return e.prototype.startScan=function(){var e=this;return this.nfc.addNdefListener(function(){console.log("NFC listener ON"),e.platform.is("ios")&&e.nfc.beginSession()},function(e){console.error("NFC listener didn't start: ",e)}).pipe(r.map(function(t){return e.ndefToDiscoveredDevice(t)}))},e.prototype.checkAvailable=function(){var e=this;return new Promise(function(t,n){return d(e,void 0,void 0,function(){var e;return h(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.nfc.enabled()];case 1:return o.sent(),t(),[3,3];case 2:return e=o.sent(),this.logError(e),n(e),[3,3];case 3:return[2]}})})})},e.prototype.stopScan=function(){},e.prototype.getProtocol=function(){return new s.NFCComProtocol},e.prototype.logError=function(e){console.error((e.message,e.message))},e.prototype.devicesArray=function(){throw new Error("Method not implemented.")},e.prototype.clearDevices=function(){throw new Error("Method not implemented.")},e.prototype.ndefToDiscoveredDevice=function(e){console.log(e);var t=e.tag.ndefMessage,n={name:String.fromCharCode.apply(String,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e}(t[3].payload)),address:this.convertBytesToBLEAddress(t[2].payload)};return console.log(n),n},e.prototype.convertBytesToBLEAddress=function(e){return e.slice(1).map(function(e){e<0&&(e+=256);var t="0"+e.toString(16).toUpperCase();return t=t.slice(-2)}).reverse().join(":")},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(u.NFC),n.inject(a.Platform))},token:e,providedIn:"root"}),e=f([n.Injectable({providedIn:"root"}),p("design:paramtypes",[c.NFC,a.Platform])],e)}(),m=function(){function e(){}return e=f([n.NgModule({declarations:[],imports:[l.CommonModule],providers:[y,g,b,c.NFC]})],e)}();e.IoTizeBle=y,e.IoTizeNfc=g,e.IoTizeTap=b,e.IotizeNgComModule=m,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=iotize-ng-com.umd.min.js.map